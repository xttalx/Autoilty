<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Buy and Sell Cars, Parts, and Accessories - Post free listings with photos in Canada's premier auto marketplace.">
    <meta name="keywords" content="buy cars Canada, sell car, auto parts, car marketplace, classified ads">
    <title>Buying & Selling Marketplace | Autoilty</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/forum.css">
    <link rel="stylesheet" href="../css/backlinks.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="../index.html" class="brand">AUTOILTY</a>
            <div class="nav-links">
                <a href="../index.html" class="nav-link">Home</a>
                <a href="../forum.html" class="nav-link">Forum</a>
                <a href="../qa.html" class="nav-link">Q&A</a>
                <a href="../guides.html" class="nav-link">Guides</a>
                <a href="../tools.html" class="nav-link">Tools</a>
            </div>
            <button class="btn-primary" onclick="showAuthModal()" id="authBtn">Sign Up / Login</button>
            <button class="btn-primary" onclick="showProfile()" id="profileBtn" style="display:none;">My Profile</button>
        </div>
    </nav>

    <div class="page-header" style="background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);">
        <div class="container">
            <div class="breadcrumb">
                <a href="../index.html">Home</a> / <a href="../forum.html">Forum</a> / <span>Buying & Selling</span>
            </div>
            <h1>üõí Buying & Selling Marketplace</h1>
            <p>Buy and Sell Cars, Parts & Accessories - Free Listings!</p>
            <button class="btn-hero" onclick="showPostModal()" style="background:#fff;color:#27ae60;padding:14px 32px;border:none;border-radius:8px;font-weight:600;font-size:16px;cursor:pointer;margin-top:20px;">
                üìù Post Free Listing
            </button>
        </div>
    </div>

    <div class="container" style="padding:48px 0;">
        <!-- Filters -->
        <div style="background:#fff;padding:24px;border-radius:12px;margin-bottom:32px;box-shadow:0 2px 8px rgba(0,0,0,0.08);">
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;">
                <select id="categoryFilter" onchange="filterListings()" style="padding:12px;border:2px solid #e0e0e0;border-radius:8px;">
                    <option value="">All Categories</option>
                    <option value="cars">Cars & Trucks</option>
                    <option value="parts">Parts & Accessories</option>
                    <option value="wheels">Wheels & Tires</option>
                    <option value="audio">Audio & Electronics</option>
                    <option value="other">Other</option>
                </select>
                <select id="priceFilter" onchange="filterListings()" style="padding:12px;border:2px solid #e0e0e0;border-radius:8px;">
                    <option value="">Any Price</option>
                    <option value="0-5000">Under $5,000</option>
                    <option value="5000-15000">$5,000 - $15,000</option>
                    <option value="15000-30000">$15,000 - $30,000</option>
                    <option value="30000+">$30,000+</option>
                </select>
                <input type="text" id="searchInput" placeholder="Search listings..." onkeyup="filterListings()" style="padding:12px;border:2px solid #e0e0e0;border-radius:8px;">
            </div>
        </div>

        <!-- Listings Grid -->
        <div id="listingsContainer" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:24px;"></div>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:10000;align-items:center;justify-content:center;">
        <div style="background:#fff;padding:40px;border-radius:16px;max-width:400px;width:90%;">
            <h2 style="margin-bottom:24px;">Sign Up / Login</h2>
            <input type="text" id="usernameInput" placeholder="Username" style="width:100%;padding:12px;margin-bottom:16px;border:2px solid #e0e0e0;border-radius:8px;">
            <input type="email" id="emailInput" placeholder="Email" style="width:100%;padding:12px;margin-bottom:16px;border:2px solid #e0e0e0;border-radius:8px;">
            <button onclick="handleAuth()" style="width:100%;padding:14px;background:#27ae60;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;margin-bottom:12px;">Continue</button>
            <button onclick="closeAuthModal()" style="width:100%;padding:14px;background:#e0e0e0;color:#333;border:none;border-radius:8px;font-weight:600;cursor:pointer;">Cancel</button>
        </div>
    </div>

    <!-- Post Listing Modal -->
    <div id="postModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:10000;align-items:center;justify-content:center;overflow-y:auto;">
        <div style="background:#fff;padding:40px;border-radius:16px;max-width:600px;width:90%;margin:40px auto;">
            <h2 style="margin-bottom:24px;">Post New Listing</h2>
            <input type="text" id="titleInput" placeholder="Title (e.g., 2018 Honda Civic)" style="width:100%;padding:12px;margin-bottom:16px;border:2px solid #e0e0e0;border-radius:8px;">
            <select id="categoryInput" style="width:100%;padding:12px;margin-bottom:16px;border:2px solid #e0e0e0;border-radius:8px;">
                <option value="cars">Cars & Trucks</option>
                <option value="parts">Parts & Accessories</option>
                <option value="wheels">Wheels & Tires</option>
                <option value="audio">Audio & Electronics</option>
                <option value="other">Other</option>
            </select>
            <input type="number" id="priceInput" placeholder="Price ($)" style="width:100%;padding:12px;margin-bottom:16px;border:2px solid #e0e0e0;border-radius:8px;">
            <input type="text" id="locationInput" placeholder="Location (City, Province)" style="width:100%;padding:12px;margin-bottom:16px;border:2px solid #e0e0e0;border-radius:8px;">
            <textarea id="descriptionInput" placeholder="Description..." rows="6" style="width:100%;padding:12px;margin-bottom:16px;border:2px solid #e0e0e0;border-radius:8px;resize:vertical;"></textarea>
            <input type="file" id="imageInput" accept="image/*" multiple style="width:100%;margin-bottom:16px;">
            <div style="font-size:12px;color:#666;margin-bottom:16px;">‚úì Upload up to 5 images</div>
            <button onclick="submitListing()" style="width:100%;padding:14px;background:#27ae60;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;margin-bottom:12px;">Post Listing</button>
            <button onclick="closePostModal()" style="width:100%;padding:14px;background:#e0e0e0;color:#333;border:none;border-radius:8px;font-weight:600;cursor:pointer;">Cancel</button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:10000;align-items:center;justify-content:center;overflow-y:auto;">
        <div style="background:#fff;padding:40px;border-radius:16px;max-width:800px;width:90%;margin:40px auto;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
                <h2 style="margin:0;">My Profile</h2>
                <button onclick="logout()" style="padding:8px 16px;background:#e74c3c;color:#fff;border:none;border-radius:6px;cursor:pointer;">Logout</button>
            </div>
            <div id="userInfo" style="background:#f8f9fa;padding:20px;border-radius:8px;margin-bottom:24px;"></div>
            <h3 style="margin-bottom:16px;">My Listings</h3>
            <div id="myListings" style="display:grid;gap:16px;"></div>
            <button onclick="closeProfile()" style="width:100%;padding:14px;background:#e0e0e0;color:#333;border:none;border-radius:8px;font-weight:600;cursor:pointer;margin-top:24px;">Close</button>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4>Marketplace</h4>
                    <ul>
                        <li><a href="#cars">Cars & Trucks</a></li>
                        <li><a href="#parts">Parts</a></li>
                        <li><a href="#wheels">Wheels & Tires</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="../guides.html">Buying Guides</a></li>
                        <li><a href="../tools/financing.html">Financing Calculator</a></li>
                        <li><a href="../qa.html">Q&A</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Community</h4>
                    <ul>
                        <li><a href="../forum.html">Forums</a></li>
                        <li><a href="../about.html">About</a></li>
                        <li><a href="../contact.html">Contact</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Autoilty. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script src="../js/backlinks.js"></script>

    // User Management
    let currentUser = JSON.parse(localStorage.getItem('autoilty_user'));
    
    function updateAuthButton() {
        if (currentUser) {
            document.getElementById('authBtn').style.display = 'none';
            document.getElementById('profileBtn').style.display = 'block';
            document.getElementById('profileBtn').textContent = currentUser.username;
        } else {
            document.getElementById('authBtn').style.display = 'block';
            document.getElementById('profileBtn').style.display = 'none';
        }
    }
    
    function showAuthModal() {
        document.getElementById('authModal').style.display = 'flex';
    }
    
    function closeAuthModal() {
        document.getElementById('authModal').style.display = 'none';
    }
    
    function handleAuth() {
        const username = document.getElementById('usernameInput').value.trim();
        const email = document.getElementById('emailInput').value.trim();
        
        if (!username || !email) {
            alert('Please enter both username and email');
            return;
        }
        
        currentUser = {
            id: 'user_' + Date.now(),
            username: username,
            email: email,
            joined: new Date().toISOString()
        };
        
        localStorage.setItem('autoilty_user', JSON.stringify(currentUser));
        closeAuthModal();
        updateAuthButton();
        alert('Welcome, ' + username + '!');
    }
    
    function logout() {
        if (confirm('Are you sure you want to logout?')) {
            localStorage.removeItem('autoilty_user');
            currentUser = null;
            updateAuthButton();
            closeProfile();
            loadListings();
        }
    }
    
    // Listings Management
    function showPostModal() {
        if (!currentUser) {
            alert('Please sign up or login to post a listing');
            showAuthModal();
            return;
        }
        document.getElementById('postModal').style.display = 'flex';
    }
    
    function closePostModal() {
        document.getElementById('postModal').style.display = 'none';
    }
    
    function submitListing() {
        if (!currentUser) {
            alert('Please login first');
            return;
        }
        
        const title = document.getElementById('titleInput').value.trim();
        const category = document.getElementById('categoryInput').value;
        const price = document.getElementById('priceInput').value;
        const location = document.getElementById('locationInput').value.trim();
        const description = document.getElementById('descriptionInput').value.trim();
        const imageFiles = document.getElementById('imageInput').files;
        
        if (!title || !price || !location || !description) {
            alert('Please fill in all fields');
            return;
        }
        
        const listing = {
            id: 'listing_' + Date.now(),
            userId: currentUser.id,
            username: currentUser.username,
            title: title,
            category: category,
            price: parseFloat(price),
            location: location,
            description: description,
            images: [],
            created: new Date().toISOString(),
            views: 0
        };
        
        // Handle images
        if (imageFiles.length > 0) {
            const reader = new FileReader();
            reader.onload = function(e) {
                listing.images.push(e.target.result);
                saveAndClosePost(listing);
            };
            reader.readAsDataURL(imageFiles[0]);
        } else {
            listing.images.push('https://via.placeholder.com/400x300?text=No+Image');
            saveAndClosePost(listing);
        }
    }
    
    function saveAndClosePost(listing) {
        let listings = JSON.parse(localStorage.getItem('autoilty_listings') || '[]');
        listings.unshift(listing);
        localStorage.setItem('autoilty_listings', JSON.stringify(listings));
        
        closePostModal();
        document.getElementById('titleInput').value = '';
        document.getElementById('priceInput').value = '';
        document.getElementById('locationInput').value = '';
        document.getElementById('descriptionInput').value = '';
        document.getElementById('imageInput').value = '';
        
        alert('Listing posted successfully!');
        loadListings();
    }
    
    function loadListings() {
        let listings = JSON.parse(localStorage.getItem('autoilty_listings') || '[]');
        
        // Add sample listings if empty
        if (listings.length === 0) {
            listings = [
                {id:'1',userId:'sample',username:'JohnDoe',title:'2020 Honda Civic Sport',category:'cars',price:22000,location:'Toronto, ON',description:'Well maintained, low km, one owner',images:['https://via.placeholder.com/400x300?text=Honda+Civic'],created:new Date().toISOString(),views:234},
                {id:'2',userId:'sample',username:'MikeTech',title:'Performance Exhaust System',category:'parts',price:800,location:'Vancouver, BC',description:'Borla cat-back exhaust, fits most vehicles',images:['https://via.placeholder.com/400x300?text=Exhaust'],created:new Date().toISOString(),views:156},
                {id:'3',userId:'sample',username:'WheelDeals',title:'18" Alloy Wheels Set of 4',category:'wheels',price:1200,location:'Calgary, AB',description:'Like new condition, includes tires',images:['https://via.placeholder.com/400x300?text=Wheels'],created:new Date().toISOString(),views:89}
            ];
        }
        
        renderListings(listings);
    }
    
    function renderListings(listings) {
        const container = document.getElementById('listingsContainer');
        container.innerHTML = '';
        
        listings.forEach(listing => {
            const card = document.createElement('div');
            card.style.cssText = 'background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.08);transition:transform 0.3s;cursor:pointer;';
            card.onmouseover = () => card.style.transform = 'translateY(-4px)';
            card.onmouseout = () => card.style.transform = 'translateY(0)';
            
            card.innerHTML = `
                <img src="${listing.images[0]}" alt="${listing.title}" style="width:100%;height:200px;object-fit:cover;">
                <div style="padding:20px;">
                    <div style="font-size:24px;font-weight:800;color:#27ae60;margin-bottom:8px;">$${listing.price.toLocaleString()}</div>
                    <h3 style="margin-bottom:8px;font-size:18px;">${listing.title}</h3>
                    <p style="color:#666;font-size:14px;margin-bottom:12px;">${listing.description.substring(0,100)}...</p>
                    <div style="display:flex;justify-content:space-between;align-items:center;padding-top:12px;border-top:1px solid #f0f0f0;">
                        <span style="color:#999;font-size:13px;">üìç ${listing.location}</span>
                        <span style="color:#999;font-size:13px;">üëÅÔ∏è ${listing.views}</span>
                    </div>
                    ${listing.userId === currentUser?.id ? `
                        <div style="margin-top:12px;display:flex;gap:8px;">
                            <button onclick="event.stopPropagation();editListing('${listing.id}')" style="flex:1;padding:8px;background:#3498db;color:#fff;border:none;border-radius:6px;cursor:pointer;">Edit</button>
                            <button onclick="event.stopPropagation();deleteListing('${listing.id}')" style="flex:1;padding:8px;background:#e74c3c;color:#fff;border:none;border-radius:6px;cursor:pointer;">Delete</button>
                        </div>
                    ` : ''}
                </div>
            `;
            
            container.appendChild(card);
        });
    }
    
    function filterListings() {
        let listings = JSON.parse(localStorage.getItem('autoilty_listings') || '[]');
        const category = document.getElementById('categoryFilter').value;
        const search = document.getElementById('searchInput').value.toLowerCase();
        
        if (category) {
            listings = listings.filter(l => l.category === category);
        }
        
        if (search) {
            listings = listings.filter(l => 
                l.title.toLowerCase().includes(search) || 
                l.description.toLowerCase().includes(search)
            );
        }
        
        renderListings(listings);
    }
    
    function deleteListing(id) {
        if (confirm('Delete this listing?')) {
            let listings = JSON.parse(localStorage.getItem('autoilty_listings') || '[]');
            listings = listings.filter(l => l.id !== id);
            localStorage.setItem('autoilty_listings', JSON.stringify(listings));
            loadListings();
        }
    }
    
    function editListing(id) {
        alert('Edit functionality coming soon!');
    }
    
    // Profile
    function showProfile() {
        if (!currentUser) return;
        
        document.getElementById('userInfo').innerHTML = `
            <h4 style="margin-bottom:12px;">${currentUser.username}</h4>
            <p style="color:#666;">${currentUser.email}</p>
            <p style="color:#999;font-size:14px;margin-top:8px;">Member since ${new Date(currentUser.joined).toLocaleDateString()}</p>
        `;
        
        const listings = JSON.parse(localStorage.getItem('autoilty_listings') || '[]')
            .filter(l => l.userId === currentUser.id);
        
        const myListingsDiv = document.getElementById('myListings');
        myListingsDiv.innerHTML = listings.length === 0 ? 
            '<p style="color:#999;">You haven\'t posted any listings yet.</p>' :
            listings.map(l => `
                <div style="background:#f8f9fa;padding:16px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;">
                    <div>
                        <strong>${l.title}</strong>
                        <p style="color:#666;font-size:14px;margin-top:4px;">$${l.price.toLocaleString()} ‚Ä¢ ${l.location}</p>
                    </div>
                    <div style="display:flex;gap:8px;">
                        <button onclick="editListing('${l.id}')" style="padding:8px 16px;background:#3498db;color:#fff;border:none;border-radius:6px;cursor:pointer;">Edit</button>
                        <button onclick="deleteListing('${l.id}')" style="padding:8px 16px;background:#e74c3c;color:#fff;border:none;border-radius:6px;cursor:pointer;">Delete</button>
                    </div>
                </div>
            `).join('');
        
        document.getElementById('profileModal').style.display = 'flex';
    }
    
    function closeProfile() {
        document.getElementById('profileModal').style.display = 'none';
    }
    
    // Initialize
    updateAuthButton();
    loadListings();
    </script>
</body>
</html>
