<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Find trusted mechanics near you. Read reviews, compare prices, and book appointments.">
    <title>Mechanic Finder | Find Trusted Auto Mechanics | Autoilty</title>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9421517198875255" crossorigin="anonymous"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/main.css">
    <style>
        .finder-container {
            padding: 48px 0;
        }
        
        .search-card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            margin-bottom: 32px;
        }
        
        .search-grid {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 16px;
        }
        
        .search-input {
            padding: 14px 18px;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .search-btn {
            padding: 14px 32px;
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .mechanic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 24px;
        }
        
        .mechanic-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }
        
        .mechanic-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        
        .mechanic-name {
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 8px;
        }
        
        .mechanic-location {
            color: #666;
            margin-bottom: 12px;
        }
        
        .mechanic-rating {
            color: #ffa500;
            font-size: 18px;
            margin-bottom: 8px;
        }
        
        .mechanic-reviews {
            color: #666;
            font-size: 14px;
            margin-bottom: 12px;
        }
        
        .mechanic-services {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .service-tag {
            background: #f0f4f8;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            color: #0066cc;
        }
        
        .contact-btn {
            width: 100%;
            padding: 12px;
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .search-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="../index.html" class="brand">AUTOILTY</a>
            <div class="nav-links">
                <a href="../index.html" class="nav-link">Home</a>
                <a href="../forum.html" class="nav-link">Forum</a>
                <a href="../qa.html" class="nav-link">Q&A</a>
                <a href="../reviews.html" class="nav-link">Reviews</a>
                <a href="../guides.html" class="nav-link">Guides</a>
                <a href="../tools.html" class="nav-link active">Tools</a>
            </div>
            <button class="mobile-toggle" onclick="toggleMobileMenu()">☰</button>
        </div>
    </nav>

    <div class="page-header">
        <div class="container">
            <h1>🔍 Mechanic Finder</h1>
            <p>Find trusted mechanics near you</p>
        </div>
    </div>

    <!-- AdSense Top Ad -->
    <div class="ad-container">
        <div class="container">
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9421517198875255" data-ad-slot="9012345678" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
    </div>

    <section class="finder-container">
        <div class="container">
            <div class="search-card">
                <div class="search-grid">
                    <input type="text" class="search-input" placeholder="Enter city or postal code" id="locationInput">
                    <select class="search-input" id="serviceType">
                        <option value="">All Services</option>
                        <option value="general">General Repair</option>
                        <option value="oil">Oil Change</option>
                        <option value="brakes">Brakes</option>
                        <option value="tires">Tires</option>
                        <option value="engine">Engine Repair</option>
                    </select>
                    <button class="search-btn" onclick="searchMechanics()">Search</button>
                </div>
            </div>
            
            <div class="mechanic-grid" id="mechanicResults">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </section>

    <!-- AdSense Footer Ad -->
    <div class="ad-container">
        <div class="container">
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9421517198875255" data-ad-slot="9012345679" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <div class="footer-brand">AUTOILTY</div>
                    <p class="footer-text">Canada's premier automotive community.</p>
                </div>
                <div class="footer-col">
                    <h4>Community</h4>
                    <ul>
                        <li><a href="../forum.html">Forum</a></li>
                        <li><a href="../qa.html">Q&A</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="../guides.html">Guides</a></li>
                        <li><a href="../tools.html">Tools</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="../about.html">About</a></li>
                        <li><a href="../contact.html">Contact</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom"><p>&copy; 2024 Autoilty.com. All rights reserved.</p></div>
        </div>
    </footer>

    <!-- Google Maps API -->
    <script src="../js/google-maps-config.js"></script>
    <script>
        // Use configured API key or fallback
        const apiKey = window.GOOGLE_MAPS_API_KEY || 'AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVsGeWbF4';
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVsGeWbF4&libraries=places&callback=initMap" async defer></script>
    
    <script src="../js/main.js"></script>
    <script>
        let map;
        let service;
        let infowindow;
        let markers = [];
        
        // Initialize Google Maps
        function initMap() {
            // Default to Toronto, ON
            const defaultLocation = { lat: 43.6532, lng: -79.3832 };
            
            map = new google.maps.Map(document.getElementById("map"), {
                center: defaultLocation,
                zoom: 12,
            });
            
            infowindow = new google.maps.InfoWindow();
            service = new google.maps.places.PlacesService(map);
            
            // Try to get user's location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        map.setCenter(userLocation);
                        map.setZoom(13);
                    },
                    () => {
                        console.log('Geolocation not available');
                    }
                );
            }
        }
        
        // Search for mechanics using Google Places API
        function searchMechanics() {
            const locationInput = document.getElementById('locationInput').value;
            const serviceType = document.getElementById('serviceType').value;
            const resultsDiv = document.getElementById('mechanicResults');
            
            if (!locationInput.trim()) {
                alert('Please enter a location (city, postal code, or address)');
                return;
            }
            
            // Show loading
            resultsDiv.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">Searching for mechanics...</div>';
            
            // Geocode the user's location input
            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ address: locationInput }, (results, status) => {
                if (status === 'OK' && results[0]) {
                    const location = results[0].geometry.location;
                    const searchLocation = {
                        lat: location.lat(),
                        lng: location.lng()
                    };
                    
                    // Center map on search location
                    map.setCenter(searchLocation);
                    map.setZoom(13);
                    
                    // Search for auto repair shops
                    const request = {
                        location: searchLocation,
                        radius: '10000',
                        query: serviceType ? 
                            `${serviceType} auto repair` : 
                            'auto repair shop'
                    };
                    
                    service.textSearch(request, (results, status) => {
                        if (status === google.maps.places.PlacesServiceStatus.OK) {
                            displayMechanics(results);
                            addMarkersToMap(results);
                        } else if (status === 'ZERO_RESULTS') {
                            resultsDiv.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">No mechanics found. Try a different location or service type.</div>';
                        } else {
                            resultsDiv.innerHTML = '<div style="text-align:center;padding:40px;color:#e74c3c;">Error searching for mechanics. Please try again.</div>';
                        }
                    });
                } else {
                    resultsDiv.innerHTML = '<div style="text-align:center;padding:40px;color:#e74c3c;">Could not find that location. Please try a valid city, postal code, or address.</div>';
                }
            });
        }
        
        // Display mechanics in cards
        function displayMechanics(places) {
            const resultsDiv = document.getElementById('mechanicResults');
            let html = '';
            
            if (places.length === 0) {
                html = '<div style="text-align:center;padding:40px;color:#666;">No mechanics found. Try a different location.</div>';
            } else {
                places.forEach((place) => {
                    const rating = place.rating ? `${'⭐'.repeat(Math.floor(place.rating))} ${place.rating.toFixed(1)}/5` : 'No rating';
                    const reviews = place.user_ratings_total ? `${place.user_ratings_total} reviews` : 'No reviews';
                    
                    html += `
                        <div class="mechanic-card">
                            <div class="mechanic-name">${place.name}</div>
                            <div class="mechanic-location">📍 ${place.formatted_address || 'Address not available'}</div>
                            <div class="mechanic-rating">${rating}</div>
                            <div class="mechanic-reviews">${reviews}</div>
                            <div class="mechanic-services">
                                ${place.types ? place.types.slice(0, 3).map(type => `<span class="service-tag">${type.replace(/_/g, ' ')}</span>`).join('') : ''}
                            </div>
                            ${place.website ? `<a href="${place.website}" target="_blank" class="contact-btn" style="text-decoration:none;display:inline-block;margin-top:8px;">View Website</a>` : ''}
                            <button class="contact-btn" onclick="showMechanicDetails('${place.place_id}', '${place.name}')">View on Map</button>
                        </div>
                    `;
                });
            }
            
            resultsDiv.innerHTML = html;
        }
        
        // Add markers to map
        function addMarkersToMap(places) {
            // Clear existing markers
            markers.forEach(marker => marker.setMap(null));
            markers = [];
            
            places.forEach((place) => {
                const marker = new google.maps.Marker({
                    position: place.geometry.location,
                    map: map,
                    title: place.name
                });
                
                marker.addListener('click', () => {
                    const content = `
                        <div style="padding:10px;">
                            <h3 style="margin:0 0 8px;">${place.name}</h3>
                            <p style="margin:4px 0;color:#666;">${place.formatted_address}</p>
                            ${place.rating ? `<p style="margin:4px 0;">Rating: ${'⭐'.repeat(Math.floor(place.rating))} ${place.rating.toFixed(1)}/5</p>` : ''}
                            ${place.phone_number ? `<p style="margin:4px 0;">📞 ${place.phone_number}</p>` : ''}
                        </div>
                    `;
                    infowindow.setContent(content);
                    infowindow.open(map, marker);
                });
                
                markers.push(marker);
            });
        }
        
        // Show mechanic details
        function showMechanicDetails(placeId, name) {
            service.getDetails({ placeId: placeId }, (place, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    map.setCenter(place.geometry.location);
                    map.setZoom(16);
                    
                    // Focus on the marker
                    markers.forEach(marker => {
                        if (marker.getPosition().equals(place.geometry.location)) {
                            google.maps.event.trigger(marker, 'click');
                        }
                    });
                }
            });
        }
        
        // Allow Enter key to trigger search
        document.getElementById('locationInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchMechanics();
            }
        });
        
        // Load sample results on page load (using Toronto as default)
        document.addEventListener('DOMContentLoaded', () => {
            // Show default location message
            document.getElementById('mechanicResults').innerHTML = 
                '<div style="text-align:center;padding:40px;color:#666;">Enter your location and click Search to find mechanics near you.</div>';
        });
    </script>
    
    <!-- Map Container (Hidden initially, shown when needed) -->
    <div id="map" style="display:none;height:0px;"></div>
</body>
</html>

