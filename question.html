<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Details | Autoilty Q&A</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/qa.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="brand">AUTOILTY</a>
            <div class="nav-links">
                <a href="index.html" class="nav-link">Home</a>
                <a href="forum.html" class="nav-link">Forum</a>
                <a href="qa.html" class="nav-link active">Q&A</a>
                <a href="guides.html" class="nav-link">Guides</a>
                <a href="tools.html" class="nav-link">Tools</a>
            </div>
            <button class="btn-primary" onclick="showAuthModal()" id="authBtn">Sign Up / Login</button>
            <button class="btn-primary" onclick="showProfile()" id="profileBtn" style="display:none;">My Profile</button>
            <button class="btn-primary" onclick="logout()" id="logoutBtn" style="display:none;background:#e74c3c;">Logout</button>
        </div>
    </nav>

    <div class="container" style="padding:48px 0;max-width:1000px;">
        <a href="qa.html" style="display:inline-block;margin-bottom:24px;color:#E2231A;text-decoration:none;font-weight:600;">‚Üê Back to Q&A</a>
        
        <!-- Question Content -->
        <div id="questionContent" style="background:#fff;border-radius:12px;padding:32px;margin-bottom:32px;box-shadow:0 2px 8px rgba(0,0,0,0.08);"></div>

        <!-- Related Resources (for maintenance/repair questions) -->
        <div id="relatedResources" style="display:none;background:#f8f9fa;border-radius:12px;padding:24px;margin-bottom:32px;border-left:4px solid #E2231A;">
            <h3 style="margin-bottom:16px;color:#E2231A;">üîó Related Resources</h3>
            <div id="relatedLinks" style="display:grid;gap:12px;"></div>
        </div>

        <!-- Answers Section -->
        <div style="background:#fff;border-radius:12px;padding:32px;margin-bottom:32px;box-shadow:0 2px 8px rgba(0,0,0,0.08);">
            <h2 style="margin-bottom:24px;"><span id="answerCount">0</span> Answers</h2>
            <div id="answersContainer" style="display:grid;gap:24px;"></div>
        </div>

        <!-- Answer Form -->
        <div style="background:#fff;border-radius:12px;padding:32px;box-shadow:0 2px 8px rgba(0,0,0,0.08);">
            <h3 style="margin-bottom:20px;">Your Answer</h3>
            <textarea id="answerContent" placeholder="Write your answer..." rows="8" style="width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;resize:vertical;margin-bottom:16px;"></textarea>
            <input type="file" id="answerImage" accept="image/*" style="width:100%;margin-bottom:16px;">
            <button onclick="postAnswer()" style="width:100%;padding:14px;background:#E2231A;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;">Post Answer</button>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:10000;align-items:center;justify-content:center;">
        <div style="background:#fff;padding:40px;border-radius:16px;max-width:400px;width:90%;">
            <h2 style="margin-bottom:24px;">Sign Up / Login</h2>
            <input type="text" id="usernameInput" placeholder="Username" style="width:100%;padding:12px;margin-bottom:16px;border:2px solid #e0e0e0;border-radius:8px;">
            <input type="email" id="emailInput" placeholder="Email" style="width:100%;padding:12px;margin-bottom:16px;border:2px solid #e0e0e0;border-radius:8px;">
            <button onclick="handleAuth()" style="width:100%;padding:14px;background:#E2231A;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;margin-bottom:12px;">Continue</button>
            <button onclick="closeAuthModal()" style="width:100%;padding:14px;background:#e0e0e0;color:#333;border:none;border-radius:8px;font-weight:600;cursor:pointer;">Cancel</button>
        </div>
    </div>

    <!-- Email Confirmation Modal -->
    <div id="emailConfirmModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:10001;align-items:center;justify-content:center;">
        <div style="background:#fff;padding:40px;border-radius:16px;max-width:500px;width:90%;text-align:center;">
            <div style="font-size:64px;margin-bottom:20px;">üìß</div>
            <h2 style="margin-bottom:16px;">Verify Your Email</h2>
            <p style="color:#666;margin-bottom:24px;">We've sent a confirmation email to:</p>
            <p style="font-weight:600;color:#E2231A;margin-bottom:24px;" id="confirmEmail"></p>
            <div style="background:#f8f9fa;padding:20px;border-radius:8px;margin-bottom:24px;">
                <p style="font-size:14px;color:#666;margin-bottom:12px;">Your confirmation code:</p>
                <p style="font-size:24px;font-weight:700;color:#E2231A;letter-spacing:4px;" id="confirmCode"></p>
            </div>
            <p style="font-size:14px;color:#999;margin-bottom:24px;">Click the button below to simulate email confirmation</p>
            <button onclick="confirmEmail()" style="width:100%;padding:14px;background:#27ae60;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;margin-bottom:12px;font-size:16px;">‚úì Confirm Email</button>
            <p style="font-size:12px;color:#999;margin-top:16px;">In production, you would click a link in your email to confirm</p>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4>Community</h4>
                    <ul>
                        <li><a href="forum.html">Forum</a></li>
                        <li><a href="qa.html">Q&A</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="guides.html">Guides</a></li>
                        <li><a href="tools.html">Tools</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Autoilty. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <script>
    // Override updateAuthButton to use auth.js
    function updateAuthButton() {
        updateAuthButtons();
    }

    // Get question ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const questionId = urlParams.get('id');
    let currentQuestion = null;
    
    // Load Question
    function loadQuestion() {
        if (!questionId) {
            window.location.href = 'qa.html';
            return;
        }
        
        const questions = JSON.parse(localStorage.getItem('autoilty_questions') || '[]');
        currentQuestion = questions.find(q => q.id === questionId);
        
        if (!currentQuestion) {
            alert('Question not found');
            window.location.href = 'qa.html';
            return;
        }
        
        // Update views
        currentQuestion.views++;
        const questionIndex = questions.findIndex(q => q.id === questionId);
        questions[questionIndex] = currentQuestion;
        localStorage.setItem('autoilty_questions', JSON.stringify(questions));
        
        const categoryColors = {
            maintenance: '#e67e22',
            buying: '#27ae60',
            diy: '#3498db',
            diagnostics: '#e74c3c',
            electric: '#9b59b6',
            general: '#95a5a6'
        };
        
        document.getElementById('questionContent').innerHTML = `
            <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:16px;">
                <h1 style="margin:0;font-size:28px;flex:1;">${currentQuestion.question}</h1>
                ${currentQuestion.solved ? '<span style="background:#27ae60;color:#fff;padding:8px 16px;border-radius:12px;font-size:14px;font-weight:600;white-space:nowrap;margin-left:16px;">‚úì Solved</span>' : ''}
            </div>
            <div style="display:flex;gap:16px;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid #f0f0f0;">
                <span style="background:${categoryColors[currentQuestion.category]};color:#fff;padding:4px 12px;border-radius:8px;font-size:14px;font-weight:600;">${currentQuestion.category}</span>
                <span style="color:#666;font-size:14px;">üë§ ${currentQuestion.username}</span>
                <span style="color:#666;font-size:14px;">üìÖ ${formatTime(currentQuestion.created)}</span>
                <span style="color:#666;font-size:14px;">üëÅÔ∏è ${currentQuestion.views} views</span>
            </div>
            ${currentQuestion.details ? `<div style="line-height:1.8;color:#333;font-size:16px;margin-bottom:24px;">${currentQuestion.details}</div>` : ''}
            ${currentQuestion.image ? `<img src="${currentQuestion.image}" style="width:100%;max-height:500px;object-fit:cover;border-radius:8px;margin-bottom:16px;">` : ''}
        `;
        
        // Show related resources for maintenance/repair questions
        if (currentQuestion.category === 'maintenance' || currentQuestion.category === 'diagnostics' || currentQuestion.category === 'diy') {
            showRelatedLinks();
        }
        
        loadAnswers();
    }
    
    // Generate Related Links based on keywords
    function showRelatedLinks() {
        const keywords = extractKeywords(currentQuestion.question + ' ' + currentQuestion.details);
        const links = generateRelatedLinks(keywords, currentQuestion.category);
        
        if (links.length > 0) {
            document.getElementById('relatedResources').style.display = 'block';
            document.getElementById('relatedLinks').innerHTML = links.map(link => `
                <a href="${link.url}" style="display:flex;align-items:center;gap:12px;padding:12px;background:#fff;border-radius:8px;text-decoration:none;color:inherit;transition:transform 0.3s;" onmouseover="this.style.transform='translateX(4px)'" onmouseout="this.style.transform='translateX(0)'">
                    <span style="font-size:24px;">${link.icon}</span>
                    <div style="flex:1;">
                        <div style="font-weight:600;color:#1a1a1a;margin-bottom:4px;">${link.title}</div>
                        <div style="font-size:13px;color:#666;">${link.description}</div>
                    </div>
                    <span style="color:#E2231A;">‚Üí</span>
                </a>
            `).join('');
        }
    }
    
    function extractKeywords(text) {
        const lowText = text.toLowerCase();
        const keywords = [];
        
        // Maintenance keywords
        if (lowText.match(/tire|tires|tyre/)) keywords.push('tires');
        if (lowText.match(/brake|brakes|pad|rotor/)) keywords.push('brakes');
        if (lowText.match(/oil|lubricant|synthetic/)) keywords.push('oil');
        if (lowText.match(/engine|motor|piston/)) keywords.push('engine');
        if (lowText.match(/transmission|gearbox|clutch/)) keywords.push('transmission');
        if (lowText.match(/battery|alternator|electrical/)) keywords.push('battery');
        if (lowText.match(/diagnostic|code|check engine|p0|dtc/)) keywords.push('diagnostics');
        if (lowText.match(/winter|snow|ice|cold/)) keywords.push('winter');
        if (lowText.match(/suspension|shock|strut/)) keywords.push('suspension');
        if (lowText.match(/exhaust|muffler|catalytic/)) keywords.push('exhaust');
        
        return [...new Set(keywords)]; // Remove duplicates
    }
    
    function generateRelatedLinks(keywords, category) {
        const linkDatabase = {
            tires: {
                icon: 'üõû',
                title: 'Winter Tire Guide',
                description: 'Complete guide to choosing and installing winter tires',
                url: 'guides.html#winter-tires'
            },
            brakes: {
                icon: 'üîß',
                title: 'Brake Maintenance Guide',
                description: 'How to inspect, maintain, and replace brake components',
                url: 'guides.html#brakes'
            },
            oil: {
                icon: 'üõ¢Ô∏è',
                title: 'Oil Change Tutorial',
                description: 'DIY oil change guide with tips and recommendations',
                url: 'guides.html#oil-change'
            },
            engine: {
                icon: '‚öôÔ∏è',
                title: 'Engine Maintenance',
                description: 'Keep your engine running smoothly with proper maintenance',
                url: 'guides.html#engine'
            },
            transmission: {
                icon: '‚ö°',
                title: 'Transmission Care',
                description: 'Understanding and maintaining your transmission',
                url: 'guides.html#transmission'
            },
            battery: {
                icon: 'üîã',
                title: 'Battery & Electrical System',
                description: 'Testing and replacing your car battery',
                url: 'guides.html#battery'
            },
            diagnostics: {
                icon: 'üîç',
                title: 'OBD-II Code Reference',
                description: 'Look up diagnostic trouble codes and solutions',
                url: 'guides.html#diagnostic-codes'
            },
            winter: {
                icon: '‚ùÑÔ∏è',
                title: 'Winter Driving Tips',
                description: 'Prepare your vehicle for Canadian winters',
                url: 'categories/winter-driving.html'
            },
            suspension: {
                icon: 'üèóÔ∏è',
                title: 'Suspension Repair Guide',
                description: 'Diagnose and fix suspension issues',
                url: 'guides.html#suspension'
            },
            exhaust: {
                icon: 'üí®',
                title: 'Exhaust System Guide',
                description: 'Understanding your exhaust and emissions system',
                url: 'guides.html#exhaust'
            }
        };
        
        // Additional helpful links
        const generalLinks = [
            {
                icon: 'üîç',
                title: 'Find a Trusted Mechanic',
                description: 'Locate certified mechanics in your area',
                url: 'tools/mechanic-finder.html'
            },
            {
                icon: 'üìÖ',
                title: 'Maintenance Tracker',
                description: 'Track your vehicle maintenance schedule',
                url: 'tools/maintenance-tracker.html'
            }
        ];
        
        const links = keywords.map(keyword => linkDatabase[keyword]).filter(Boolean);
        return [...links, ...generalLinks].slice(0, 5); // Max 5 links
    }
    
    // Load Answers
    function loadAnswers() {
        const answers = JSON.parse(localStorage.getItem('autoilty_answers') || '[]')
            .filter(a => a.questionId === questionId)
            .sort((a, b) => {
                if (a.bestAnswer && !b.bestAnswer) return -1;
                if (!a.bestAnswer && b.bestAnswer) return 1;
                return (b.upvotes || 0) - (a.upvotes || 0);
            });
        
        document.getElementById('answerCount').textContent = answers.length;
        
        const container = document.getElementById('answersContainer');
        
        if (answers.length === 0) {
            container.innerHTML = '<p style="color:#999;text-align:center;padding:40px;">No answers yet. Be the first to help!</p>';
            return;
        }
        
        container.innerHTML = answers.map(answer => `
            <div style="background:#f8f9fa;border-radius:12px;padding:24px;${answer.bestAnswer ? 'border-left:4px solid #27ae60;' : ''}">
                ${answer.bestAnswer ? '<div style="color:#27ae60;font-weight:600;margin-bottom:12px;">‚úì Best Answer</div>' : ''}
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid #e0e0e0;">
                    <div style="display:flex;gap:12px;align-items:center;">
                        <span style="font-weight:600;color:#1a1a1a;">üë§ ${answer.username}</span>
                        <span style="color:#999;font-size:14px;">${formatTime(answer.created)}</span>
                    </div>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <span style="color:#999;font-size:14px;">üëç ${answer.upvotes || 0} helpful</span>
                    </div>
                </div>
                <div style="line-height:1.6;color:#333;margin-bottom:12px;">${answer.answer}</div>
                ${answer.image ? `<img src="${answer.image}" style="width:100%;max-height:400px;object-fit:cover;border-radius:8px;margin-top:12px;">` : ''}
            </div>
        `).join('');
    }
    
    // Post Answer
    function postAnswer() {
        if (!currentUser) {
            alert('Please sign up or login to post an answer');
            showAuthModal();
            return;
        }
        
        if (!currentUser.confirmed) {
            alert('‚ö†Ô∏è Please confirm your email before posting answers.\n\nCheck your email for the confirmation link.');
            showEmailConfirmation();
            return;
        }
        
        const content = document.getElementById('answerContent').value.trim();
        const imageFile = document.getElementById('answerImage').files[0];
        
        if (!content) {
            alert('Please write an answer');
            return;
        }
        
        const answer = {
            id: 'ans_' + Date.now(),
            questionId: questionId,
            userId: currentUser.id,
            username: currentUser.username,
            answer: content,
            image: null,
            created: new Date().toISOString(),
            upvotes: 0,
            bestAnswer: false
        };
        
        if (imageFile) {
            const reader = new FileReader();
            reader.onload = function(e) {
                answer.image = e.target.result;
                saveAnswer(answer);
            };
            reader.readAsDataURL(imageFile);
        } else {
            saveAnswer(answer);
        }
    }
    
    function saveAnswer(answer) {
        let answers = JSON.parse(localStorage.getItem('autoilty_answers') || '[]');
        answers.push(answer);
        localStorage.setItem('autoilty_answers', JSON.stringify(answers));
        
        // Update question answer count
        let questions = JSON.parse(localStorage.getItem('autoilty_questions') || '[]');
        const questionIndex = questions.findIndex(q => q.id === questionId);
        if (questionIndex !== -1) {
            questions[questionIndex].answers++;
            localStorage.setItem('autoilty_questions', JSON.stringify(questions));
        }
        
        document.getElementById('answerContent').value = '';
        document.getElementById('answerImage').value = '';
        
        alert('Answer posted successfully!');
        loadAnswers();
    }
    
    function formatTime(timestamp) {
        const diff = Date.now() - new Date(timestamp).getTime();
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);
        
        if (hours < 1) return 'Just now';
        if (hours < 24) return `${hours}h ago`;
        if (days < 7) return `${days}d ago`;
        return new Date(timestamp).toLocaleDateString();
    }
    
    // Initialize
    updateAuthButton();
    loadQuestion();
    </script>
</body>
</html>

